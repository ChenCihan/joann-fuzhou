---
import { Image } from 'astro:assets';
import Layout from './Layout.astro';
import 'photoswipe/style.css';

export interface GalleryImage {
	src: string;
	width: number;
	height: number;
}

interface Props {
	images: GalleryImage[];
	title?: string;
}
const { images, title = 'Gallery' } = Astro.props;
---

<Layout title={title} description="A modern photo gallery">
<main class="relative min-h-screen">
	<header class="border-b border-stone-800/60 bg-stone-950/80 backdrop-blur-sm sticky top-0 z-20">
		<div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-6">
			<h1 class="font-instrument text-3xl sm:text-4xl tracking-tight text-stone-100">
				{title}
			</h1>
			<p class="mt-1 font-outfit text-sm font-light text-stone-500">
				{images.length} photo{images.length === 1 ? '' : 's'}
			</p>
		</div>
	</header>

	<div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-8 sm:py-12">
		{images.length > 0 ? (
			<div
				id="gallery"
				class="gallery masonry-columns"
				role="list"
			>
				{images.map((img, i) => (
					<a
						href={img.src}
						data-pswp-width={img.width}
						data-pswp-height={img.height}
						class="gallery-item group block mb-4 break-inside-avoid"
						role="listitem"
					>
						<div class="overflow-hidden rounded-xl ring-1 ring-stone-800/80 transition-all duration-300 group-hover:ring-stone-600/80 group-hover:shadow-2xl group-hover:shadow-black/30">
							<Image
								src={img.src}
								alt=""
								width={img.width}
								height={img.height}
								class="w-full h-auto object-cover transition-transform duration-500 ease-out group-hover:scale-[1.02]"
								loading={i < 8 ? 'eager' : 'lazy'}
								decoding="async"
							/>
						</div>
					</a>
				))}
			</div>
		) : (
			<div class="rounded-2xl border border-dashed border-stone-700 bg-stone-900/40 p-12 sm:p-16 text-center">
				<p class="font-outfit text-stone-500 text-lg">
					No photos yet. Add JPG files to <code class="rounded bg-stone-800 px-2 py-0.5 text-stone-400">public/gallery</code> and rebuild.
				</p>
			</div>
		)}
	</div>
</main>

	<!-- PhotoSwipe root -->
<div class="pswp" id="pswp-root" tabindex="-1" role="dialog" aria-hidden="true">
	<div class="pswp__bg"></div>
	<div class="pswp__scroll-wrap">
		<div class="pswp__container">
			<div class="pswp__item"></div>
			<div class="pswp__item"></div>
			<div class="pswp__item"></div>
		</div>
		<div class="pswp__ui pswp__ui--hidden">
			<div class="pswp__top-bar">
				<div class="pswp__counter"></div>
				<button class="pswp__button pswp__button--close" title="Close"></button>
				<button class="pswp__button pswp__button--share" title="Share"></button>
				<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
				<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
				<div class="pswp__preloader">
					<div class="pswp__preloader__icn">
						<div class="pswp__preloader__cut">
							<div class="pswp__preloader__donut"></div>
						</div>
					</div>
				</div>
			</div>
			<div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
				<div class="pswp__share-toolbar"></div>
			</div>
			<button class="pswp__button pswp__button--arrow--left" title="Previous"></button>
			<button class="pswp__button pswp__button--arrow--right" title="Next"></button>
			<div class="pswp__caption">
				<div class="pswp__caption__center"></div>
			</div>
		</div>
	</div>
</div>
</Layout>

<style is:global>
	.gallery.masonry-columns {
		column-count: 2;
		column-gap: 1rem;
	}
	@media (min-width: 640px) {
		.gallery.masonry-columns {
			column-gap: 1.25rem;
		}
	}
	@media (min-width: 768px) {
		.gallery.masonry-columns {
			column-count: 3;
			column-gap: 1.5rem;
		}
	}
	@media (min-width: 1024px) {
		.gallery.masonry-columns {
			column-count: 4;
			column-gap: 1.5rem;
		}
	}
	.gallery-item {
		display: block;
	}
</style>

<script>
	import PhotoSwipeLightbox from 'photoswipe/lightbox';

	const lightbox = new PhotoSwipeLightbox({
		gallery: '#gallery',
		children: 'a',
		pswpModule: () => import('photoswipe'),
		pswpOptions: {
			mainClass: 'pswp--custom',
		},
	});
	lightbox.init();
</script>
