---
import fs from 'node:fs';
import path from 'node:path';
import imageSize from 'image-size';
import Gallery from '../components/Gallery.astro';

const galleryDir = path.join(process.cwd(), 'public', 'gallery');
const jpgRegex = /\.(jpe?g|JPE?G)$/;
const files = fs.existsSync(galleryDir)
	? fs.readdirSync(galleryDir).filter((f) => jpgRegex.test(f)).sort()
	: [];

const images = files.map((file) => {
	const fullPath = path.join(galleryDir, file);
	const buffer = fs.readFileSync(fullPath);
	const dimensions = imageSize(new Uint8Array(buffer));
	return {
		src: '/gallery/' + file,
		width: dimensions?.width ?? 1200,
		height: dimensions?.height ?? 800,
	};
});
---

<Gallery
	images={images}
	title="Jo Ann in Fuzhou"
	subtitle="Early 2000s"
	description="A photo gallery website showcasing Jo Ann Walczak's experience teaching English in Fuzhou, China in the early 2000s."
/>
